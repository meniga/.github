name: Legacy CI

# What should trigger this workflow to be executed
on:
  # Define which push events should trigger this workflow
  push:
    # Trigger a build when pushing to any branch or when tagging
    branches: ['**']
    tags: ['*']

    # Except when the only files that changed match these patterns
    paths-ignore:
    # Ignore everything in the .github directory except the legacy-ci.yaml workflow file
    - '.github/**'
    - '!.github/workflows/legacy-ci.yaml'
    - 'docs/**'
    - '*.md'

  ## Uncomment to run this workflow every Friday at midnight
  #schedule:
  #- cron:  '0 0 * * FRI'

# The actual workflow
jobs:
  ci:
    # This will execute the workflow on our self-hosted Windows VM
    runs-on: [self-hosted, Windows]

    steps:
    - uses: actions/checkout@v2
      # Remove if you don't need to fetch all history for all branches and tags
      with:
        fetch-depth: 0
        
    # Remove this step if you are not using submodules
    #
    # Fetching submodules with the actions/checkout action fails because
    # it generates an invalid Windows path when storing the public SSH key
    # Tip: Add the --recursive flag if your submodules include submodules
    - name: Update git submodules
      run: git submodules update --init

    # Adjust as needed, e.g. psake tryci to run the TryCI task
    - name: Run CI task using psake
      run: psake ci
